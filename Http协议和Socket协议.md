### Http协议和Socket协议
#### 网络中的协议的分层
##### ISO/OSI参考模型与TCP/IP协议模型中各层的对应关系  
![](http://img.blog.csdn.net/20130909165027546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHR5dXJlbmNhb3Rhbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)   
 
**简言之，各层的作用：**  
　物理层：在物理媒体上传输原始的数据比特流。  
　数据链路层：将数据分成一个个数据帧，以数据帧为单位传输。有应有答，遇错重发。  
　网络层：将数据分成一定长度的分组，将分组穿过通信子网，从信源选择路径后传到信宿。  
 　  传输层：提供不具体网络的高效、经济、透明的端到端数据传输服务。  
 　  会话层：进程间的对话也称为会话，会话层管理不同主机上各进程间的对话。  
  　 表示层： 为应用层进程提供格式化的表示和转换数据服务。  
  　 应用层：提供应用程序访问OSI环境的手段。
  　     
  　     
**数据的封装和解封**  
![](http://img.blog.csdn.net/20130909165032968?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvaHR5dXJlbmNhb3Rhbmc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)  

**OSI网络体系结构各层协议**  
1）应用层：TELNET、FTP、TFTP、SMTP、SNMP、HTTP、BOOTP、DHCP、DNS  
（2）表示层：
                         文本：ASCII，EBCDIC
                         图形：TIFF，JPEG，GIF，PICT
                         声音：MIDI，MPEG，QUICKTIME  
（3）会话层：NFS、SQL、RPC 、X-WINDOWS、ASP（APPTALK会话协议）、SCP   
（4）传输层：TCP、UDP、SPX   
（5）网络层：IP、IPX、ICMP、RIP、OSPF(Open Shortest Path First开放式最短路径优先)  
（6）数据链路层：SDLC、HDLC、PPP、STP（Spanning Tree Protocol）、帧中继  
（7）物理层：EIA/TIA RS-232、EIA/TIA RS-449、V.35、RJ-45    

  
### Socket与TCP/IP的区别  
 
 **建立socket连接**
 
 建立Socket连接至少需要一对套接字，其中一个运行于客户端，称为ClientSocket ，另一个运行于服务器端，称为ServerSocket 。
 
套接字之间的连接过程分为三个步骤：服务器监听，客户端请求，连接确认。
 
服务器监听：服务器端套接字并不定位具体的客户端套接字，而是处于等待连接的状态，实时监控网络状态，等待客户端的连接请求。
 
客户端请求：指客户端的套接字提出连接请求，要连接的目标是服务器端的套接字。为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。
 
连接确认：当服务器端套接字监听到或者说接收到客户端套接字的连接请求时，就响应客户端套接字的请求，建立一个新的线程，把服务器端套接字的描述发给客户端，一旦客户端确认了此描述，双方就正式建立连接。而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。
 
 **SOCKET连接与TCP/IP连接**
 
创建Socket连接时，可以指定使用的传输层协议，Socket可以支持不同的传输层协议（TCP或UDP），当使用TCP协议进行连接时，该Socket连接就是一个TCP连接。
 
 socket则是对TCP/IP协议的封装和应用（程序员层面上）。也可以说，TPC/IP协议是传输层协议，主要解决数据 如何在网络中传输，而HTTP是应用层协议，主要解决如何包装数据。关于TCP/IP和HTTP协议的关系，网络有一段比较容易理解的介绍：
 <font color='#008B8B'>
“我们在传输数据时，可以只使用（传输层）TCP/IP协议，但是那样的话，如 果没有应用层，便无法识别数据内容，如果想要使传输的数据有意义，则必须使用到应用层协议，应用层协议有很多，比如HTTP、FTP、TELNET等，也 可以自己定义应用层协议。WEB使用HTTP协议作应用层协议，以封装HTTP文本信息，然后使用TCP/IP做传输层协议将它发到网络上。”
</font>
 
我们平时说的最多的socket是什么呢，实际上socket是对TCP/IP协议的封装，Socket本身并不是协议，而是一个调用接口（API），通过Socket，我们才能使用TCP/IP协议。 实际上，Socket跟TCP/IP协议没有必然的联系。Socket编程接口在设计的时候，就希望也能适应其他的网络协议。所以说，Socket的出现 只是使得程序员更方便地使用TCP/IP协议栈而已，是对TCP/IP协议的抽象，从而形成了我们知道的一些最基本的函数接口，比如create、 listen、connect、accept、send、read和write等等。网络有一段关于socket和TCP/IP协议关系的说法比较容易理解：
 <font color='#008B8B'>
“TCP/IP只是一个协议栈，就像操作系统的运行机制一样，必须要具体实现，同时还要提供对外的操作接口。这个就像操作系统会提供标准的编程接口，比如win32编程接口一样，TCP/IP也要提供可供程序员做网络开发所用的接口，这就是Socket编程接口。” 
实际上，传输层的TCP是基于网络层的IP协议的，而应用层的HTTP协议又是基于传输层的TCP协议的，而Socket本身不算是协议，就像上面所说，它只是提供了一个针对TCP或者UDP编程的接口。socket是对端口通信开发的工具,它要更底层一些.
</font>
 
**Socket连接与HTTP连接**
 
由于通常情况下Socket连接就是TCP连接，因此Socket连接一旦建立，通信双方即可开始相互发送数据内容，直到双方连接断开。但在实际网络应用中，客户端到服务器之间的通信往往需要穿越多个中间节点，例如路由器、网关、防火墙等，大部分防火墙默认会关闭长时间处于非活跃状态的连接而导致 Socket 连接断连，因此需要通过轮询告诉网络，该连接处于活跃状态。
 
 而HTTP连接使用的是“请求—响应”的方式，不仅在请求时需要先建立连接，而且需要客户端向服务器发出请求后，服务器端才能回复数据。
 
很多情况下，需要服务器端主动向客户端推送数据，保持客户端与服务器数据的实时与同步。此时若双方建立的是Socket连接，服务器就可以直接将数据传送给客户端；若双方建立的是HTTP连接，则服务器需要等到客户端发送一次请求后才能将数据传回给客户端，因此，客户端定时向服务器端发送连接请求，不仅可以保持在线，同时也是在“询问”服务器是否有新的数据，如果有就将数据传给客户端。  


#### 窗口和滑动窗口
TCP的流量控制
TCP使用窗口机制进行流量控制
什么是窗口？
连接建立时，各端分配一块缓冲区用来存储接收的数据，并将缓冲区的尺寸发送给另一端
接收方发送的确认信息中包含了自己剩余的缓冲区尺寸
剩余缓冲区空间的数量叫做窗口  
#### TCP的流控过程（滑动窗口）    
下图表示的是流量控制的过程
![](http://images.cnitblog.com/blog/88420/201402/081517071882901.png)

#### 三次连接握手和四次挥手    

![](http://images.cnitblog.com/blog/88420/201402/181351206012825.png)

**过程讲解**  
*握手的过程：*  
**第一次握手:**
客户端发送一个TCP的SYN标志位置1的包指明客户打算连接的服务器的端口，以及初始序号X,保存在包头的序列号(Sequence Number)字段里。  
**第二次握手:**
服务器发回确认包(ACK)应答。即SYN标志位和ACK标志位均为1同时，将确认序号(Acknowledgement Number)设置为客户的I S N加1以.即X+1。  
**第三次握手.**
客户端再次发送确认包(ACK) SYN标志位为0,ACK标志位为1.并且把服务器发来ACK的序号字段+1,放在确定字段中发送给对方.并且在数据段放写ISN的+1  

*断开的过程*  
（1）客户端A发送一个FIN，用来关闭客户A到服务器B的数据传送。 
（2）服务器B收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。 
（3）服务器B关闭与客户端A的连接，发送一个FIN给客户端A。 
（4）客户端A发回ACK报文确认，并将确认序号设置为收到序号加1。 


